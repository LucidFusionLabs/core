# $Id: CMakeLists.txt 1004 2011-08-27 19:09:26Z justin $

if(WIN32)
INCLUDE_EXTERNAL_MSPROJECT(libprotobuf-lite ${CMAKE_CURRENT_SOURCE_DIR}/vsprojects/libprotobuf-lite.vcxproj)
else(WIN32)

if(LFL_ANDROID)
set(ENV{CC} "${ANDROIDROOT}/bin/arm-linux-androideabi-gcc")
set(ENV{CXX} "${ANDROIDROOT}/bin/arm-linux-androideabi-g++")
set(ENV{CPP} "${ANDROIDROOT}/bin/arm-linux-androideabi-cpp")
set(ENV{CXXCPP} "${ANDROIDROOT}/bin/arm-linux-androideabi-cpp")
set(ENV{AR} "${ANDROIDROOT}/bin/arm-linux-androideabi-ar")
set(ENV{RANLIB} "${ANDROIDROOT}/bin/arm-linux-androideabi-ranlib")
set(CONFIGURE_OPTIONS ${CONFIGURE_OPTIONS} -host arm --enable-static=yes --enable-shared=no --with-protoc=${CMAKE_CURRENT_SOURCE_DIR}/bin/osx64/protoc)
set(CFLAGS "-isysroot ${ANDROIDROOT}/sysroot -I${ANDROIDROOT}/sysroot/usr/include -I${ANDROIDROOT}/arm-linux-androideabi/include/c++/4.6 -I${ANDROIDROOT}/arm-linux-androideabi/include/c++/4.6/arm-linux-androideabi")
set(ENV{CFLAGS} ${CFLAGS})
set(ENV{CXXFLAGS} ${CFLAGS})
set(ENV{LDFLAGS} "-isysroot ${ANDROIDROOT}/sysroot")

elseif(LFL_IPHONE)
set(ENV{CC} "${IPHONEROOT}/usr/bin/gcc")
set(ENV{CXX} "${IPHONEROOT}/usr/bin/g++")
set(ENV{CPP} "${IPHONEROOT}/usr/bin/llvm-cpp-4.2")
set(ENV{CXXCPP} "${IPHONEROOT}/usr/bin/llvm-cpp-4.2")
set(ENV{AR} "${IPHONEROOT}/usr/bin/ar")
if(IPHONESIM)
set(CONFIGURE_OPTIONS ${CONFIGURE_OPTIONS} --enable-static=yes --enable-shared=no --with-protoc=${CMAKE_CURRENT_SOURCE_DIR}/bin/osx64/protoc)
set(CFLAGS "-arch i686 -pipe -mdynamic-no-pic -std=c99 -Wno-trigraphs -fpascal-strings -fasm-blocks -O0 -Wreturn-type -Wunused-variable -fmessage-length=0 -fvisibility=hidden -mmacosx-version-min=10.5 -I${IPHONESDK}/usr/include/ -isysroot ${IPHONESDK}")
set(ENV{CXXFLAGS} ${CFLAGS})
set(ENV{CFLAGS} ${CFLAGS})
set(ENV{LDFLAGS} "-arch i686 -isysroot ${IPHONESDK} -Wl,-dead_strip -mmacosx-version-min=10.5")
else(IPHONESIM)
set(CONFIGURE_OPTIONS ${CONFIGURE_OPTIONS} --host=arm-apple-darwin --enable-static=yes --enable-shared=no --with-protoc=${CMAKE_CURRENT_SOURCE_DIR}/bin/osx64/protoc)
set(CFLAGS "-arch armv7 -pipe -mdynamic-no-pic -std=c99 -Wno-trigraphs -fpascal-strings -O0 -Wreturn-type -Wunused-variable -fmessage-length=0 -fvisibility=hidden -miphoneos-version-min=2.0 -gdwarf-2 -mthumb -I${IPHONESDK}/usr/include/libxml2 -isysroot ${IPHONESDK}")
set(ENV{CFLAGS} ${CFLAGS})
set(ENV{CXXFLAGS} ${CFLAGS})
set(ENV{LDFLAGS} "-arch armv7 -isysroot ${IPHONESDK} -Wl,-dead_strip -miphoneos-version-min=2.0")
endif(IPHONESIM)

else(LFL_ANDROID)
set(CONFIGURE_OPTIONS ${CONFIGURE_OPTIONS} --enable-static=yes --enable-shared=no)
endif(LFL_ANDROID)

autoconf(./configure "${CONFIGURE_OPTIONS}" make)
endif(WIN32)
